<?xml version="1.0" encoding="UTF-8" ?>

<project name="SimpleCalculator" default="default" basedir="."
  xmlns:fx="javafx:com.sun.javafx.tools.ant">

  <property environment="env"/>
  <property name="env.JAVA_HOME" value="${env.JAVA_HOME}"/>
  <property name="build.src.dir" value="src"/>
  <property name="build.classes.dir" value="classes"/>
  <property name="build.dist.dir" value="dist"/>
  <property name="jar.name" value="Calc.jar"/>

  <target name="default" depends="clean,compile">

    <taskdef resource="com/sun/javafx/tools/ant/antlib.xml"
      uri="javafx:com.sun.javafx.tools.ant"
      classpath="${env.JAVA_HOME}/lib/ant-javafx.jar"/>

    <fx:application id="SimpleCalculatorID"
      name="SimpleCalculator"
      mainClass="app.Main"/>

    <fx:resources id="appRes">
      <fx:fileset dir="${build.dist.dir}" includes="${jar.name}"/>
    </fx:resources>

    <fx:jar destfile="${build.dist.dir}/${jar.name}">
      <fx:application refid="SimpleCalculatorID"/>
      <fx:resources refid="appRes"/>
      <fileset dir="${build.classes.dir}"/>
    </fx:jar>

    <fx:deploy width="300" height="250"
      outdir="." embedJNLP="true"
      outfile="calc"
      nativeBundles="image">

      <fx:platform basedir="${env.JAVA_HOME}">
        <fx:jvmuserarg name="-Xms" value="31m"/>
        <fx:jvmuserarg name="-Xmx" value="64m"/>
      </fx:platform>

      <fx:application refId="SimpleCalculatorID"/>

      <fx:resources refid="appRes"/>

      <fx:info title="SimpleCalculator"
        vendor="Jiro"/>

    </fx:deploy>

  </target>

  <target name="clean">
    <mkdir dir="${build.classes.dir}"/>
    <mkdir dir="${build.dist.dir}"/>

    <delete>
      <fileset dir="${build.classes.dir}" includes="**/*"/>
      <fileset dir="${build.dist.dir}" includes="**/*"/>
    </delete>

  </target>

  <target name="compile" depends="clean">

    <javac includeantruntime="false"
      srcdir="${build.src.dir}"
      destdir="${build.classes.dir}"
      fork="yes"
      executable="${env.JAVA_HOME}/bin/javac"
      encoding="utf-8"
      source="1.8"
      debug="on">
    </javac>

    <!-- リソースファイルの梱包-->
    <copy todir="classes">
      <fileset dir="src">
        <include name="**/*.css"/>
        <include name="**/*.fxml"/>
        <include name="**/*.properties"/>
      </fileset>
    </copy>

    <!-- Set preferences -->

    <java fork="true" jvm="${env.JAVA_HOME}\bin\java"
      classname="app.Main" classpath="${build.classes.dir}">
      <sysproperty key="app.preferences.id" value="SimpleCalculatorID"/>
    </java>
  </target>

  <target name="jar" depends="compile">
    <jar destfile="dist/${jar.name}"
      basedir="classes"/>
  </target>

</project>
